# Employee Records Management System

## Постановка задачи

Система управления доступом к файлу записей сотрудников через именованные каналы с сервер-клиент архитектурой.

### Компоненты системы

**Процесс-сервер**:
1. Создает и управляет бинарным файлом сотрудников
2. Обрабатывает запросы клиентов через именованные каналы
3. Реализует механизмы блокировки записей
4. Контролирует параллельный доступ

**Процесс-клиент (Client)**:
1. Подключается к серверу через именованный канал
2. Предоставляет интерфейс для:
   - Чтения записей сотрудников
   - Модификации записей
3. Обрабатывает пользовательский ввод

## Структура данных

```cpp
struct employee {
    int num;        // идентификационный номер сотрудника
    char name[10];  // имя сотрудника
    double hours;   // количество отработанных часов
};
```

## Используемые инструменты

### Система сборки
- **CMake** (минимальная версия 3.10)
- Поддержка межпроцессного взаимодействия

### Тестирование
- **Google Test (gtest)** для модульного тестирования
- Тестовые сценарии:
  - Создание/чтение файла записей
  - Механизмы блокировки записей
  - Обработка параллельных запросов
  - Корректность передачи данных

### Компилятор
- Требуется поддержка C++17 или новее
- Необходима поддержка:
  - Работы с файлами
  - Именованных каналов
  - Многопоточности

### Платформа
- Изначально разработано для Windows (Named Pipes)
- Может быть портировано на Linux (FIFO)

## Сборка и запуск

1. Соберите проект:
```bash
mkdir build && cd build
cmake .. && cmake --build .
```

2. Запустите сервер:
```bash
./server employees.bin
```

3. В отдельных терминалах запустите клиенты:
```bash
./client
```

## Структура проекта

```
employee_system/
├── CMakeLists.txt            # Основная конфигурация
├── include/
│   ├── employee.h           # Структура employee
│   ├── server.h             # Интерфейс сервера
│   ├── client.h             # Интерфейс клиента
│   ├── pipe_manager.h       # Управление каналами
│   └── record_locker.h     # Механизм блокировок
├── src/
│   ├── main_server.cpp      # Точка входа сервера
│   ├── main_client.cpp      # Точка входа клиента
│   ├── server.cpp           # Реализация сервера
│   ├── client.cpp           # Реализация клиента
│   ├── pipe_manager.cpp     # Работа с каналами
│   └── record_locker.cpp   # Блокировка записей
├── test/
│   ├── test_server.cpp      # Тесты сервера
│   ├── test_client.cpp      # Тесты клиента
│   └── test_integration.cpp # Интеграционные тесты
└── README.md               # Этот файл
```

## Протокол взаимодействия

1. **Установка соединения**:
   - Клиент подключается к именованному каналу сервера
   - Сервер создает отдельный канал для ответа

2. **Типы запросов**:
   ```cpp
   enum class RequestType {
       READ,
       WRITE,
       RELEASE,
       EXIT
   };
   ```

3. **Формат сообщений**:
   - Запрос:
   ```cpp
   struct Request {
       RequestType type;
       int employee_id;
       employee data; // Для модификации
   };
   ```
   - Ответ:
   ```cpp
   struct Response {
       bool success;
       employee data;
   };
   ```

## Механизм блокировок

1. **Для записи**:
   - Полная блокировка записи для других клиентов
   - Освобождение после завершения модификации

2. **Для чтения**:
   - Разрешение множественного чтения
   - Блокировка при попытке записи

## Алгоритм работы сервера

1. Инициализация файла сотрудников
2. Создание именованного канала
3. Ожидание подключений клиентов
4. Для каждого запроса:
   - Проверка типа операции
   - Применение соответствующих блокировок
   - Выполнение операции
   - Отправка ответа
5. Завершение работы по команде

## Алгоритм работы клиента

1. Подключение к серверу
2. Цикл:
   - Запрос операции у пользователя
   - Отправка запроса серверу
   - Получение и отображение результата
   - Для модификации: запрос новых данных
3. Закрытие соединения

## Особенности реализации

1. **Синхронизация**:
   - Мьютексы для защиты разделяемых ресурсов
   - Условные переменные для ожидания освобождения записей

2. **Обработка ошибок**:
   - Проверка корректности ввода
   - Обработка ошибок соединения
   - Восстановление после сбоев

3. **Масштабируемость**:
   - Поддержка множества клиентов
   - Оптимизированные блокировки

4. **Безопасность**:
   - Валидация входных данных
   - Защита от взаимоблокировок
